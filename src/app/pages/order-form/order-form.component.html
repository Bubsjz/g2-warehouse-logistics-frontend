<section class="container mt-4">
  <div class="card shadow-lg p-4">
    <h3 class="text-center my-4">
      {{ mode === 'create' ? 'Create Order' : mode === 'edit' ? 'Edit Order' : 'Review Order' }}
    </h3>
    <hr />
    <form (ngSubmit)="mode === 'review' ? submitReview() : saveDelivery()" #orderForm="ngForm">
      <!-- Mostrar mensaje de error -->
      <div *ngIf="submitted && errorMessage" class="alert alert-danger">
        {{ errorMessage }}
      </div>

      <!-- Fecha de envío -->
      <div class="my-3">
        <label class="form-label" for="send-date">Send Date</label>
        <input
          class="form-control rounded-pill"
          type="date"
          id="send-date"
          [ngModel]="delivery.send_date ? formatDateForInput(delivery.send_date) : ''"
          (ngModelChange)="onDateChange('send_date', $event)"
          name="send_date"
          [disabled]="mode === 'review'"
          required
        />
        <div *ngIf="submitted && !delivery.send_date" class="text-danger">
          Send date is required.
        </div>
      </div>

      <!-- Fecha de recepción -->
      <div class="my-3">
        <label class="form-label" for="received-date">Received Date</label>
        <input
          class="form-control rounded-pill"
          type="date"
          id="received-date"
          [ngModel]="delivery.received_date ? formatDateForInput(delivery.received_date) : ''"
          (ngModelChange)="onDateChange('received_date', $event)"
          name="received_date"
          [disabled]="mode === 'review'"
          required
        />
        <div *ngIf="submitted && !delivery.received_date" class="text-danger">
          Received date is required.
        </div>
      </div>

      <!-- Almacén de origen -->
      <div class="my-3">
        <label class="form-label" for="origin">Origin Warehouse</label>
        <select
          class="form-select rounded-pill"
          id="origin"
          [(ngModel)]="delivery.origin_warehouse_id"
          name="origin_warehouse_id"
          [disabled]="mode === 'review'"
          required
        >
          <option [ngValue]="null" disabled>Select the origin warehouse</option>
          <option *ngFor="let warehouse of warehouses" [value]="warehouse.id_warehouse">
            {{ warehouse.name }}
          </option>
        </select>
        <div *ngIf="orderForm.submitted && !orderForm.controls['origin_warehouse_id']?.valid" class="text-danger">
          Origin warehouse is required.
        </div>
      </div>

      <!-- Almacén de destino -->
      <div class="my-3">
        <label class="form-label" for="destination">Destination Warehouse</label>
        <select
          class="form-select rounded-pill"
          id="destination"
          [(ngModel)]="delivery.destination_warehouse_id"
          name="destination_warehouse_id"
          [disabled]="mode === 'review'"
          required
        >
          <option [ngValue]="null" disabled>Select the destination warehouse</option>
          <option *ngFor="let warehouse of warehouses" [value]="warehouse.id_warehouse">
            {{ warehouse.name }}
          </option>
        </select>
        <div *ngIf="orderForm.submitted && !orderForm.controls['destination_warehouse_id']?.valid" class="text-danger">
          Destination warehouse is required.
        </div>
      </div>

      <!-- Matrícula del camión -->
      <div class="my-3">
        <label class="form-label" for="truck">Truck License Plate</label>
        <select
          class="form-select rounded-pill"
          id="truck"
          [(ngModel)]="delivery.truck_id_truck"
          name="truck_id_truck"
          [disabled]="mode === 'review'"
          required
        >
          <option [ngValue]="null" disabled>Select the truck</option>
          <option *ngFor="let truck of trucks" [value]="truck.id_truck">
            {{ truck.plate }}
          </option>
        </select>
        <div *ngIf="orderForm.submitted && !orderForm.controls['truck_id_truck']?.valid" class="text-danger">
          Truck is required.
        </div>
      </div>

      <!-- Productos -->
      <p class="fw-bold mt-4">Order Details</p>
      <div *ngFor="let detail of orderDetails; let i = index" class="my-3 d-flex align-items-center gap-3">
        <!-- Selector de tipo de producto -->
        <select
          class="form-select rounded-pill w-50"
          [(ngModel)]="detail.product_id"
          name="product-{{ i }}"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="mode === 'review'"
          (change)="detail.touched = true"
          required
        >
          <option [ngValue]="null" disabled>Select a product</option>
          <option *ngFor="let product of products" [value]="product.id_product">
            {{ product.name }}
          </option>
        </select>
        <!-- Validación -->
        <div *ngIf="detail.touched && !detail.product_id" class="text-danger">
          Product is required.
        </div>

        <!-- Campo de cantidad -->
        <input
          type="number"
          class="form-control rounded-pill w-25"
          placeholder="Quantity"
          [(ngModel)]="detail.quantity"
          name="quantity-{{ i }}"
          [ngModelOptions]="{ standalone: true }"
          [disabled]="mode === 'review'"
          min="1"
          (blur)="detail.touched = true"
          required
        />
        <!-- Validación -->
        <div *ngIf="detail.touched && (!detail.quantity || detail.quantity <= 0)" class="text-danger">
          Quantity must be greater than 0.
        </div>

        <!-- Botón para eliminar producto -->
        <button type="button" class="btn btn-danger" *ngIf="mode !== 'review'" (click)="removeProduct(i)">
          &minus;
        </button>
      </div>

      <!-- Botón para agregar nuevos productos -->
      <div class="my-3">
        <button type="button" class="btn btn-primary rounded-pill" *ngIf="mode !== 'review'" (click)="addProduct()">
          + Add Product
        </button>
      </div>

      <!-- Sección de comentarios solo visible en modo edit y review -->
      <div class="my-3" *ngIf="mode !== 'create'">
        <label class="form-label" for="comments">Comments</label>
        <textarea
          class="form-control"
          id="comments"
          [(ngModel)]="delivery.comments"
          name="comments"
          [disabled]="mode !== 'review'"
          placeholder="No comments"
          rows="3"
        ></textarea>
      </div>

      <!-- Botones -->
      <div class="d-flex justify-content-center gap-2 my-4">
        <button
          type="submit"
          class="btn btn-success rounded-pill"
          *ngIf="mode !== 'review'"
          [disabled]="!validateForm()"
        >
          {{ mode === 'create' ? 'Create Order' : 'Save Changes' }}
        </button>
        <button
          class="btn btn-primary rounded-pill"
          type="button"
          (click)="submitReview()"
          *ngIf="mode === 'review'"
          [disabled]="!delivery.comments || delivery.comments.trim() === ''"
        >
          Send Comments
        </button>
        <button
          class="btn btn-success rounded-pill"
          type="button"
          (click)="approveDelivery()"
          *ngIf="mode === 'review'"
        >
          Approve
        </button>
        <button
          type="button"
          class="btn btn-danger rounded-pill"
          (click)="cancel()"
        >
          Cancel
        </button>
      </div>
    </form>
  </div>
</section>


<!-- <section class="container">
  <div class="card shadow-lg p-4">
    <h3 class="text-center my-4">Insert a order</h3>
    <hr />
    <form>
      <div class="my-3">
        <label class="form-label" for="send-date">Send date</label>
        <input
          class="form-control rounded-pill"
          type="date"
          id="send-date"
          formControlName="send-date"
          placeholder="Enter the send date"
        />
      </div>
      <div class="my-3">
        <label class="form-label" for="received-date">Received date</label>
        <input
          class="form-control rounded-pill"
          type="date"
          id="received-date"
          formControlName="received-date"
          placeholder="Enter the received date"
        />
      </div>
      <div class="my-3">
        <label class="form-label" for="truck-id">Truck license plate</label>
        <input
          class="form-control rounded-pill"
          type="text"
          id="truck-id"
          formControlName="truck-id"
          placeholder="Enter the truck license plate"
        />
      </div>
      <div class="my-3">
        <label class="form-label" for="origin">Origin</label>
        <select
          class="form-select rounded-pill"
          id="origin"
          formControlName="origin"
        >
          <option value="">Select the origin</option>
          <option value="warehouse A">Warehouse A</option>
          <option value="warehouse B">Warehouse B</option>
          <option value="warehouse C">Warehouse C</option>
        </select>
      </div>
      <div class="my-3">
        <label class="form-label" for="destination">Destination</label>
        <select
          class="form-select rounded-pill"
          id="destination"
          formControlName="destination"
        >
          <option value="">Select the destination</option>
          <option value="warehouse A">Warehouse A</option>
          <option value="warehouse B">Warehouse B</option>
          <option value="warehouse C">Warehouse C</option>
        </select>
      </div>
      <div class="my-3">
        <label class="form-label" for="status-sending">Status sending</label>
        <select
          class="form-select rounded-pill"
          id="status-sending"
          formControlName="status-sending"
        >
          <option value="">Select a status sending</option>
          <option value="pending">Pending</option>
          <option value="review">Review</option>
          <option value="correction-needed">Correction needed</option>
          <option value="ready-departure">Ready departure</option>
          <option value="in-transit">In transit</option>
          <option value="delivered">Delivered</option>
        </select>
      </div>
      <div class="my-3">
        <label class="form-label" for="status-reception"
          >Status reception</label
        >
        <select
          class="form-select rounded-pill"
          id="status-reception"
          formControlName="status-reception"
        >
          <option value="">Select a status reception</option>
          <option value="arriving">Arriving</option>
          <option value="arrived">Arrived</option>
          <option value="review">Review</option>
          <option value="send-back">Send back</option>
          <option value="accepted">Accepted</option>
        </select>
      </div>
      <p class="fw-bold mt-4">Order Details Information</p>
      <div class="my-3">
        <label class="product" for="product">Product</label>
        <select
          class="form-select rounded-pill"
          id="product"
          formControlName="product"
        >
          <option value="">Select the product</option>
          <option value="fruit">Fruit</option>
          <option value="vegetable">Vegetable</option>
          <option value="dairy-product">Dairy product</option>
          <option value="meat">Meat</option>
          <option value="fish">Fish</option>
        </select>
      </div>
      <div class="my-3">
        <label class="form-label" for="quantity">Quantity</label>
        <input
          class="form-control rounded-pill"
          type="number"
          id="quantity"
          formControlName="quantity"
          placeholder="Enter the quantity in kg"
          min="0"
          step="0.1"
        />
      </div>
      <hr />
      <div class="my-3">
        <label class="form-label" for="comments">Comments</label>
        <input
          class="form-control rounded-pill"
          type="text"
          id="comments"
          formControlName="comments"
          placeholder="Add a comment"
        />
      </div>
      <div class="d-flex justify-content-center gap-2 my-3">
        <input
          type="submit"
          value="Create"
          class="btn btn-success rounded-pill btn-size"
        />
        <input
          type="submit"
          value="Back to home"
          class="btn btn-danger rounded-pill btn-size"
        />
      </div>
    </form>
  </div>
</section> -->


